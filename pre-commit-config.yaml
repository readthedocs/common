exclude: '^$|settings|scripts'
fail_fast: false
repos:

- repo: https://github.com/pre-commit/pre-commit-hooks
  rev: v4.4.0
  hooks:
    # Disabled because yapf is better for our purpose
    # - id: autopep8-wrapper
    - id: check-added-large-files
    - id: check-ast
    - id: check-case-conflict
    - id: check-executables-have-shebangs
    - id: check-json
    - id: check-shebang-scripts-are-executable
    - id: check-toml
    - id: check-vcs-permalinks
    - id: debug-statements
    - id: fix-byte-order-marker
    - id: end-of-file-fixer
    - id: fix-encoding-pragma
      exclude: |
        (?x)^(
            readthedocs/rtd_tests/files/conf.py|
        )$
      args: ['--remove']
    - id: check-merge-conflict
    - id: check-symlinks
    - id: trailing-whitespace
      exclude: |
        (?x)^(
            docs/.+/locale/.*\.po|
            .+\.svg|
            .+\.js|
            .+\.css|
        )$
    - id: mixed-line-ending
      args: ['--fix=lf']

- repo: https://github.com/PyCQA/autoflake
  rev: v2.1.1
  hooks:
    - id: autoflake
      args: ['--in-place', '--remove-all-unused-imports', '--remove-unused-variable']

# TODO: re-enable it and use `--range` to select the modified lines
# - repo: https://github.com/myint/docformatter.git
#   rev: v1.4
#   hooks:
#     - id: docformatter
#       args: ['--in-place', '--wrap-summaries=80', '--wrap-descriptions=80', '--pre-summary-newline']

- repo: https://github.com/adamchainz/django-upgrade
  rev: "1.14.0"
  hooks:
  - id: django-upgrade
    args: [--target-version, "4.2"]

- repo: https://github.com/akaihola/darker
  rev: 1.7.1
  hooks:
    - id: darker
      # TODO: find a way to pass `--check` only when running via `tox -e
      # pre-commit`
      args: ['--isort']
      additional_dependencies:
        - isort==5.12.0
        - black==23.3.0
      exclude: |
        (?x)^(
            readthedocs/rtd_tests/files/conf.py|
        )$

- repo: https://github.com/asottile/blacken-docs
  rev: 1.13.0
  hooks:
    - id: blacken-docs
      additional_dependencies: [black==22.10.0]

- repo: https://github.com/PyCQA/prospector
  rev: 1.10.2
  hooks:
    - id: prospector
      args:
        - --profile=prospector.yml
        - --die-on-tool-error
      exclude: |
        (?x)^(
            docs/.*|
            common/.*|
            .*/settings/.*|
            .*/rtd_tests/.*|
            .*/tests/.*|
            .*/migrations/.*
        )$
      # Because of an issue with pylint's Django utils and PATH environment, we add PYTHONPATH.
      # This was used as a hack when running on Circle CI as well
      # Once we upgrade to prospector >=1.9, we can remove it again.
      entry: env PYTHONPATH=readthedocs:../readthedocs.org:./ DJANGO_SETTINGS_MODULE=readthedocs.settings.test prospector
      # We have to install the dependencies from an URL since we don't have access to this file easily from pre-commit
      additional_dependencies:
        - -r
        - https://raw.githubusercontent.com/readthedocs/readthedocs.org/main/requirements/testing.txt

