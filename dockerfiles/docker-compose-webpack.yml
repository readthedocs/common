# docker-compose-webpack.yml starts Webpack dev server for hot reload of built
# static assets.

services:

  webpack:
    build:
      context: ${PWD}/${RTDDEV_PATH_EXT_THEME:-../ext-theme}
      dockerfile: ${PWD}/common/dockerfiles/Dockerfile.webpack
    working_dir: /usr/src/app/checkouts/ext-theme
    ports:
      - "10001:10001"
    volumes:
      - ${PWD}/${RTDDEV_PATH_EXT_THEME:-../ext-theme}/src:/usr/src/app/checkouts/ext-theme/src
      - ${PWD}/${RTDDEV_PATH_EXT_THEME:-../ext-theme}/readthedocsext:/usr/src/app/checkouts/ext-theme/readthedocsext
      - ${PWD}/${RTDDEV_PATH_EXT_THEME:-../ext-theme}/webpack.config.mjs:/usr/src/app/checkouts/ext-theme/webpack.config.mjs
    environment:
      - INIT=${INIT:-}
      - DOCKER_NO_RELOAD
      - NODE_ENV=development
      - RTD_EXT_THEME_ENABLED
      - RTD_EXT_THEME_DEV_SERVER_ENABLED
    stdin_open: true
    tty: true
    networks:
      readthedocs:
    command: [
      "./node_modules/.bin/webpack-dev-server",
      "--mode=development",
      "--host=0.0.0.0",
      "--port=10001",
    ]
